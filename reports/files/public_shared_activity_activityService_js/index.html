<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Plato - public/shared/activity/activityService.js</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="">
  <meta name="author" content="">

  <!--[if lt IE 9]>
  <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <link href="../../assets/css/vendor/morris.css" rel="stylesheet">
  <link href="../../assets/css/vendor/bootstrap.css" rel="stylesheet">
  <link href="../../assets/css/vendor/font-awesome.css" rel="stylesheet">
  <link href="../../assets/css/vendor/codemirror.css" rel="stylesheet">
  <link href="../../assets/css/plato.css" rel="stylesheet">
  <link href="../../assets/css/plato-file.css" rel="stylesheet">

</head>

<body>

<div class="navbar navbar-fixed-top">
  <div class="container">
    <a class="navbar-brand" href="http://github.com/es-analysis/plato">Plato on Github</a>
    <ul class="nav navbar-nav">
      <li>
        <a href="../../index.html">Report Home</a>
      </li>
    </ul>
  </div>
</div>

<div class="jumbotron">
  <div class="container">
    <h1>public/shared/activity/activityService.js</h1>
  </div>
</div>

<div class="container aggregate-stats">
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Maintainability <a href="http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="A value between 0 and 100 that represents the relative ease of maintaining the code. A high value means better maintainability." data-original-title="Maintainability Index"  data-container="body"></i></a></h2>
      <p class="stat">74.62</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Lines of code <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h2>
      <p class="stat">243</p>
    </div>
  </div>
  <div class="row historical">
    <div class="col-md-6">
      <p id="chart_historical_maint" class="chart"></p>
    </div>
    <div class="col-md-6">
      <p id="chart_historical_sloc" class="chart"></p>
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h2 class="header">Difficulty  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="The difficulty measure is related to the difficulty of the program to write or understand." data-original-title="Difficulty" data-container="body"></i></a></h2>
      <p class="stat">36.51</p>
    </div>
    <div class="col-md-6">
      <h2 class="header">Estimated Errors  <a href="http://en.wikipedia.org/wiki/Halstead_complexity_measures"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Halstead's delivered bugs is an estimate for the number of errors in the implementation." data-original-title="Delivered Bugs" data-container="body"></i></a></h2>
      <p class="stat">1.96</p>
    </div>
  </div>
</div>

<div class="container charts">
  <div class="row">
    <h2 class="header">Function weight</h2>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h3 class="chart-header">By Complexity <a href="http://en.wikipedia.org/wiki/Cyclomatic_complexity"><i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="This metric counts the number of distinct paths through a block of code. Lower values are better." data-original-title="Cyclomatic Complexity" data-container="body"></i></a></h3>
      <div id="fn-by-complexity" class="stat"></div>
    </div>
    <div class="col-md-6">
      <h3 class="chart-header">By SLOC  <i class="icon icon-info-sign" rel="popover" data-placement="top" data-trigger="hover" data-content="Source Lines of Code / Logical Lines of Code" data-original-title="SLOC/LSLOC" data-container="body"></i></h3>
      <div id="fn-by-sloc" class="stat"></div>
    </div>
  </div>
</div>

<div class="container">
  <div class="row">
    <textarea id="file-source" class="col-md-12">(function () {
  &#039;use strict&#039;;

  angular.module(&#039;openpbl.services&#039;)
    .factory(&#039;activityService&#039;, [&#039;$http&#039;, &#039;$q&#039;, &#039;factService&#039;, &#039;globalValues&#039;, &#039;hypothesisService&#039;, &#039;participantService&#039;, &#039;resolutionService&#039;, &#039;storyService&#039;, &#039;researchService&#039;, &#039;abstractionService&#039;,
      function ($http, $q, factService, globalValues, hypothesisService, participantService, resolutionService, storyService, researchService, abstractionService) {

      var addActivityFact = function (activityId, fact) {
        return factService.addFact(activityId, fact);
      };

      var addActivityHypothesis = function (activityId, hypothesis) {
        return hypothesisService.addHypothesis(activityId, hypothesis);
      };

      var addActivityResolution = function (activityId, resolution) {
        return resolutionService.addResolution(activityId, resolution);
      };

      var saveActivityStory = function (activityId, story) {
        return storyService.addStory(activityId, story);
      };

      var addActivityParticipant = function (activityId, participant) {
        return participantService.addParticipant(activityId, participant);
      };

      var saveActivityResearch = function (activityId, research) {
        return researchService.addResearch(activityId, research);
      };

      var saveActivityAbstraction = function (activityId, abstraction) {
        return abstractionService.addAbstraction(activityId, abstraction);
      };

      var deleteActivity = function (activityId) {
        var deferred = $q.defer()
        , url = globalValues.API_URL + &#039;/activity/&#039; + activityId;

        $http.delete(url)
          .then(function () {
            var response = {
              message: &#039;Atividade removida com sucesso&#039;
            };

            deferred.resolve(response);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

          return deferred.promise;
      };

      var deleteActivityFact = function (activityId, factId) {
        return factService.deleteFact(activityId, factId);
      };

      var deleteActivityHypothesis = function (activityId, hypothesisId) {
        return hypothesisService.deleteHypothesis(activityId, hypothesisId);
      };

      var deleteActivityPartipant = function (activityId, participantId) {
        return participantService.deleteParticipant(activityId, participantId);
      };

      var deleteActivityResolution = function (activityId, resolutionId) {
        return resolutionService.deleteResolution(activityId, resolutionId);
      };

      var deleteActivityStory = function (activityId, storyId) {
        return storyService.deleteStory(activityId, storyId);
      };

      var getActivities = function () {
        var deferred = $q.defer()
        , url = globalValues.API_URL + &#039;/activity&#039;;

        $http.get(url, { cache: false })
          .then(function (response) {
            var activities = {
              active: [],
              finished: []
            };

            var activity = null;
            
            for (var i = 0, length = response.data.activities.length; i &lt; length; i++) {
              activity = response.data.activities[i];

              if (activity.status !== globalValues.activity.status.FINISHED) {
                activities.active.push(activity);
              } else {
                activities.finished.push(activity);
              }
            }

            deferred.resolve(activities);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

        return deferred.promise;
      };

      var getActivityById = function (activityId) {
        var deferred = $q.defer()
        , url = globalValues.API_URL + &#039;/activity/&#039; + activityId;

        $http.get(url)
          .then(function (response) {
            deferred.resolve(response.data);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

        return deferred.promise;
      };

      var getActivityFacts = function (activityId) {
        return factService.getFacts(activityId);
      };

      var getActivityHypotheses = function (activityId) {
        return hypothesisService.getHypotheses(activityId);
      };

      var getActivityParticipants = function (activityId) {
        return participantService.getParticipants(activityId);
      };

      var getActivityStatusData = function (activityId, status) {
        var deferred = $q.defer()
        , statusPropertyName = getStatusPropertyName(status)
        , url = globalValues.API_URL + &#039;/activity/&#039; + activityId + &#039;/&#039; + statusPropertyName;

        $http.get(url)
          .then(function (response) {
            deferred.resolve(response.data);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

        return deferred.promise;
      };

      var getStatusPropertyName = function (status) {
        var activityStatus = globalValues.activity.status;

        switch (status) {
          case activityStatus.CREATING_STORY:
            return &#039;story&#039;;

          case activityStatus.GENERATING_FACTS:
            return &#039;fact&#039;;

          case activityStatus.IDENTIFYING_HIPOTESYS:
            return &#039;hypothesis&#039;;

          case activityStatus.RESEARCHING:
            return &#039;research&#039;;

          case activityStatus.RESOLVING_PROBLEM:
            return &#039;resolution&#039;;

          case activityStatus.ABSTRACTING:
            return &#039;abstraction&#039;;

          case activityStatus.FINISHED:
            return &#039;finished&#039;;

          default:
            throw new Error(&#039;Status inválido&#039;);
        }
      };

      var getActivityStories = function (activityId) {
        return storyService.deleteStories(activityId);
      };

      var nextStatus = function (activityId, status) {
        var deferred = $q.defer()
        , url = globalValues.API_URL + &#039;/activity/&#039; + activityId
        , data = {
          status: status
        };

        $http.put(url, data)
          .then(function (response) {
            deferred.resolve(response.data);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

        return deferred.promise;
      };

      var saveActivity = function (activity) {
        var deferred = $q.defer()
        , url = globalValues.API_URL + &#039;/activity&#039;;

        $http.post(url, activity)
          .then(function (response) {
            deferred.resolve(response.data);
          })
          .catch(function (error) {
            deferred.reject(error);
          });

        return deferred.promise;
      };

      return {
        addActivityFact: addActivityFact,
        addActivityHypothesis: addActivityHypothesis,
        addActivityParticipant: addActivityParticipant,
        addActivityResolution: addActivityResolution,
        saveActivityStory: saveActivityStory,
        saveActivityResearch: saveActivityResearch,
        saveActivityAbstraction: saveActivityAbstraction,
        deleteActivity: deleteActivity,
        deleteActivityFact: deleteActivityFact,
        deleteActivityHypothesis: deleteActivityHypothesis,
        deleteActivityPartipant: deleteActivityPartipant,
        deleteActivityResolution: deleteActivityResolution,
        deleteActivityStory: deleteActivityStory,
        getActivities: getActivities,
        getActivityById: getActivityById,
        getActivityFacts: getActivityFacts, 
        getActivityHypotheses: getActivityHypotheses,
        getActivityParticipants: getActivityParticipants,
        getActivityStatusData: getActivityStatusData,
        getStatusPropertyName: getStatusPropertyName,
        getActivityStories: getActivityStories,
        nextStatus: nextStatus,
        saveActivity: saveActivity
      };
    }]);
})();</textarea>
  </div>
</div>

<footer class="footer">
  <div class="container">
    <p>.</p>
  </div>
</footer>

<script type="text/html" id="complexity-popover-template">
  <div class="complexity-notice">
    Complexity : {{ complexity.cyclomatic }} <br>
    Length : {{ complexity.halstead.length }} <br>
    Difficulty : {{ complexity.halstead.difficulty.toFixed(2) }} <br>
    Est # bugs : {{ complexity.halstead.bugs.toFixed(2) }}<br>
  </div>
</script>

<script type="text/javascript" src="../../assets/scripts/bundles/core-bundle.js"></script>
<script type="text/javascript" src="../../assets/scripts/bundles/codemirror.js"></script>
<script type="text/javascript" src="../../assets/scripts/codemirror.markpopovertext.js"></script>
<script type="text/javascript" src="report.js"></script>
<script type="text/javascript" src="report.history.js"></script>
<script type="text/javascript" src="../../assets/scripts/plato-file.js"></script>
</body>
</html>
